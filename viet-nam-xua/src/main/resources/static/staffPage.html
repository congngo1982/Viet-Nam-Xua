<!DOCTYPE html>
<html>

<head>
  <title>Staff Page</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.4/dist/jquery.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
  <style>
    /* CSS body */
    body {
      font-family: Cambria, Cochin, Georgia, Times, 'Times New Roman', serif;
      background-image: url("images/moutain.gif");
      background-size: cover;
      margin: 0;
    }

    /* CSS header */
    header {
      display: flex;
      background-color: rgba(255, 255, 255, 0.5);
      color: black;
      justify-content: space-between;
    }

    .header-left {
      margin-left: 20px;
      justify-content: flex-start;
      color: #413130;
      text-shadow: 2px 2px 4px rgba(255, 255, 255, 0.5);
    }

    .header-right {
      margin-right: 40px;
      display: flex;
      justify-content: flex-end;
      align-items: center;
    }

    .header-right a {
      margin-left: 20px;
      text-decoration: none;
      font-size: 20px;
      color: black;
    }

    /* CSS trang chính */
    .container {
      display: flex;
      justify-content: space-between;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: rgba(255, 255, 255, 0.5);
      padding: 20px;
      text-align: center;
      border-radius: 10px;
    }

    .menu {
      background-color: white;
      border-radius: 10px;
      width: 40%;
    }

    .menu a {
      display: block;
      padding: 10px 20px;
      background-color: #f5f5f5;
      color: #333;
      text-decoration: none;
      margin-bottom: 10px;
    }

    .menu a:hover {
      background-color: #e0e0e0;
    }

    .content {
      background-color: #f5f5f5;
      padding: 20px;
      margin-left: 20px;
      width: 60%;
      height: 50vh;
      overflow: auto;
      border-radius: 10px;
      text-align: left;
    }

    .content a {
      display: inline-block;
      padding: 10px 20px;
      text-decoration: none;
      background-color: white;
      color: #0D487C;
      border: 2px solid #0D487C;
      cursor: pointer;
      text-align: center;
    }

    .table-list {
      display: flex;
      flex-direction: column;
    }

    .table-list-header {
      display: flex;
      justify-content: space-between;
      font-weight: bold;
      padding: 5px;
      background-color: lightgray;
    }

    .table-list-item {
      display: flex;
      justify-content: space-between;
      padding: 5px;
      border-bottom: 1px solid lightgray;
    }

    /* CSS footer */
    footer {
      background-color: #333;
      color: #fff;
      padding: 10px;
      text-align: center;
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
    }
  </style>
  <script>

    function showContent(contentId) {
      var contents = document.getElementsByClassName("content");
      for (var i = 0; i < contents.length; i++) {
        contents[i].style.display = "none";
      }
      document.getElementById(contentId).style.display = "block";
    }


    document.addEventListener("DOMContentLoaded", function () {
      var today = new Date().toISOString().split('T')[0];
      document.getElementById('booking-date').value = today;
    });

  </script>
</head>

<body onload="GetUser()">
  <!-- Header -->
  <header>
    <div class="header-left">
      <h1>Việt Nam Xưa Restaurant</h1>
    </div>
    <div class="header-right">
      <a href="home.html">Home</a>
      <a id="login" href="login.html">Login</a>
      <a id="register" href="register.html">Register</a>
      <a id="logout" href="/logout" style="display: none">Logout</a>
      <a id="account" href="" style="display: none"><img src="images/account.png" style="width: 30px"></a>
    </div>
  </header>

  <!-- The Modal -->
  <div class="modal" id="filter" style="margin-top: 10%;">
    <div class="modal-dialog">
      <div class="modal-content">

        <!-- Modal body -->
        <div class="modal-body">
          <form id="filterTable">
            <label for="table-type">Bàn:</label>
            <select id="table-type" class="custom-select mb-3" name="txtTable">
              <option value="A">A</option>
              <option value="B">B</option>
              <option value="C">C</option>
            </select>

            <div class="form-group">
              <label for="booking-date">Ngày:</label>
              <input type="date" class="form-control" id="booking-date" name="txtDate">
            </div>
            <select id="booking-status" name="reser-status" class="custom-select mb-3">
              <option value="2">Đã hoàn thành</option>
              <option value="0">Đã huỷ</option>
              <option value="1">Đã đặt bàn</option>
            </select>
            <button type="submit" class="btn btn-primary">Get Table</button>
          </form>
        </div>

      </div>
    </div>
  </div>

  <!-- Trang chính -->
  <div class="container">
    <div class="menu">
      <br>
      <h2 id="staff_name">Staff A</h2> <br>
      <a href="#personal" onclick="showContent('personal')">Thông tin cá nhân</a>
      <a href="#table-management" onclick="GetAllTable('GetFilterTable')" on>Quản lí đặt bàn</a>
      <a href="#table-list" onclick="GetAllTable('GetAllTable')">Danh sách bàn</a>
      <a href="#feedback" onclick="showContent('feedback')">Feedback của khách</a>
    </div>
    <div class="content" id="personal">
      Họ và tên: <input id="staffName" type="text" value="Staff A" readonly style="color: gray"
        class="form-control"></br>
      Số điện thoại: <input id="staffPhone" type="text" value="0123 456 789" readonly style="color: gray"
        class="form-control"></br>
      Email: <input type="email" id="staffMail" value="staff@gmail.com" readonly style="color: gray"
        class="form-control"></br>
      <a href="#change-password" class="btn btn-primary" onclick="showContent('change-password')">Đổi mật khẩu</a>
    </div>
    <div class="content" id="table-management">
      <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#filter">Get Table</button>
      <button type="button" class="btn btn-primary" onclick="GetSuccessfulReservation()">Get Successful
        Reservation</button>
      <span id="btnComplete" style="display: none;"><button type="button" class="btn btn-primary"
          onclick="CompleteReservation()">Attendance</button></span>
      <span id="btnCancel" style="display: none;"><button type="button" class="btn btn-primary"
          onclick="CancelReservation()">Cancel</button></span>
      <br>
      <br>
      <div>
        <input class="form-control" type="text" name="txtSearchReser" id="search_Reser" onkeyup="GetReservationById()">
      </div>
      <table class="table table-hover">
        <thead>
          <tr>
            <th>Name</th>
            <th>Time</th>
            <th>Note</th>
          </tr>
        </thead>
        <tbody id="filter_table_list">
        </tbody>
      </table>
    </div>
    <div class="content" id="table-list">

      <table class="table table-hover">
        <thead>
          <tr>
            <th>Tên bàn</th>
            <th>Số chỗ ngồi</th>
            <th>Trạng thái</th>
          </tr>
        </thead>
        <tbody id="allTable">
        </tbody>
      </table>
      <div>
        <a href="#add-table" onclick="showContent('add-table')">Thêm bàn</a>
        <!-- <a href="#">Chỉnh sửa</a> -->
      </div>
    </div>
    <div class="content" id="feedback">
      <!-- Nội dung của phần Feedback của khách -->
    </div>
    <div class="content" id="change-password">
      <label for="password">Mật khẩu mới:</label>
      <input type="password" id="password" name="password" required><br>

      <label for="confirm-password">Nhập lại mật khẩu:</label>
      <input type="password" id="confirm-password" name="confirm-password" required><br>
      <div id="notice"></div>

      <button class="btn btn-primary" onclick="UpdatePassword()">Xác nhận</button>
    </div>
    <div class="content" id="add-table">
      <label for="table-name">Tên bàn:</label>
      <input type="text" placeholder="Id" id="tableId" required />

      <label for="seats">Số chỗ ngồi tối đa:</label>
      <input type="number" placeholder="Quantity" id="tableQuantity" />

      <label for="status">Trạng thái:</label>
      <!-- <input type="text" placeholder="Status" id="tableStatus" /> -->
      <select id="tableStatus">
        <option value="open">Open</option>
        <option value="close">Close</option>
      </select><br>
      <button onclick="AddTable()">Xác nhận</button>
    </div>
  </div>
  <!-- Footer -->
  <footer>
    Copyright &copy; 2023 - Việt Nam Xưa Restaurant
  </footer>
  <script>
    // Hiển thị nội dung tab "Thông tin cá nhân" khi trang được tải lần đầu
    showContent("personal");

    function GetUser() {
      document.getElementById("logout").style.display = "none";
      let xhr = new XMLHttpRequest()
      xhr.open("GET", "http://localhost:8080/account/getuser", true)
      xhr.setRequestHeader('Content-type', 'application/json; charset=UTF-8')
      xhr.onload = function () {
        var result = this.responseText;
        if (result != null && result != "") {
          document.getElementById("login").style.display = "none";
          document.getElementById("register").style.display = "none";
          document.getElementById("logout").style.display = "block";
          document.getElementById("account").style.display = "block";
          result = JSON.parse(this.responseText);
          if (result.role == "USER") {
            document.getElementById("account").href = "/userPage.html";
          } else {
            document.getElementById("account").href = "/staffPage.html";
          }
          document.getElementById("staffName").value = result.fullName;
          document.getElementById("staff_name").innerHTML = result.fullName;
          document.getElementById("staffPhone").value = result.phone;
          document.getElementById("staffMail").value = result.email;
        }
        console.log(result.role);
      }
      xhr.send();
    }

    function GetAllTable(functionName) {
      if (functionName == "GetAllTable") {
        showContent('table-list');
      } else if (functionName == "GetFilterTable") { showContent('table-management') }

      function GetTableBody(name, quantity, status) {
        var option = `<option selected value="open">Open</option>
                <option value="close">Close</option>`;
        if (status != 1) {
          option = `<option value="open">Open</option>
                <option selected value="close">Close</option>`;
        }
        var tbody = `<tr>
            <td>${name}</td>
            <td>${quantity}</td>
            <td>
              <select name="status" class="custom-select mb-3">
                ${option}
              </select>
            </td>
          </tr>`;
        return tbody;
      }

      let xhr = new XMLHttpRequest()
      xhr.open("GET", "http://localhost:8080/table/gettall", true)
      xhr.setRequestHeader('Content-type', 'application/json; charset=UTF-8')
      xhr.onload = function () {
        var result = this.responseText;
        if (result != null && result != "") {
          result = JSON.parse(this.responseText);
          var tbody = ``;
          if (functionName == "GetAllTable") {
            result.forEach(element => {
              tbody += GetTableBody(element.id, element.quantity, element.status);
            });
            document.getElementById('allTable').innerHTML = tbody;
          } else if (functionName == "GetFilterTable") {
            showContent('table-management')
            result.forEach(element => {
              tbody += `<option value="${element.id}">${element.id}</option>`;
            });
            document.getElementById("table-type").innerHTML = tbody;
          }
          console.log(result);
        }
      }
      xhr.send();
    }

    const form = document.getElementById("filterTable");
    form.addEventListener("submit", (e) => {
      e.preventDefault();
      var name = document.getElementById("table-type").value;
      var date = document.getElementById("booking-date").value;
      var status = document.getElementById("booking-status").value;
      ChangeTbody(`http://localhost:8080/reservation/getfilter?txtTable=${name}&txtDate=${date}&txtstatus=${status}`, "GET");
    });
    function GetSuccessfulReservation() {
      ChangeTbody(`http://localhost:8080/reservation/getsuccessful`, "GET")
    }

    function GetReservationById() {
      ChangeTbody(`http://localhost:8080/reservation/getreserbyid/${document.getElementById("search_Reser").value}`, "GET", "haha");
    }

    function AddTable() {
      var id = document.getElementById("tableId").value;
      var quantity = document.getElementById("tableQuantity").value;
      var status = document.getElementById("tableStatus").value == "open" ? 1 : 2;
      var table = {
        "id": id,
        "quantity": quantity,
        "status": status,
      }
      let post = JSON.stringify(table)
      CallAjax("POST", "http://localhost:8080/table/create", post);
    }

    function CallAjax(method, url, requestBody) {
      let xhr = new XMLHttpRequest()
      xhr.open(method, url, true)
      xhr.setRequestHeader('Content-type', 'application/json; charset=UTF-8')
      if (requestBody != null) {
        xhr.send(requestBody);
      }
      xhr.onload = function () {
        var result = this.responseText;
        // alert(result);
      }
    }

    function ChangeTbody(url, method, condition) {
      var result;
      var bodyContent = function (name, date, note) {
        var content = `<tr>
            <td>${name}</td>
            <td>${date}</td>
            <td>${note}</td>
          </tr>`;
        return content;
      }
      let xhr = new XMLHttpRequest()
      xhr.open(method, url, true)
      xhr.setRequestHeader('Content-type', 'application/json; charset=UTF-8')
      xhr.onload = function () {
        var result = this.responseText;
        if (result != null && result != "") {
          result = "OK"
          result = JSON.parse(this.responseText);
          var tbody = ``;
          if (condition != null && result.length > 0) {
            document.getElementById("btnComplete").style.display = "inline-block";
            document.getElementById("btnCancel").style.display = "inline-block";
          } else {
            document.getElementById("btnComplete").style.display = "none";
            document.getElementById("btnCancel").style.display = "none";
          }
          result.forEach(element => {
            var reserDate = (new Date(element.createdDate) + "").split(":");
            tbody += bodyContent(element.note.split("`")[0], reserDate[0] + ":" + reserDate[1], element.note == null ? "" : element.note.split("`")[1]);
            if (element.status != 1) {
              document.getElementById("btnComplete").style.display = "none";
              document.getElementById("btnCancel").style.display = "none";
            }
          });
          console.log(result);
          document.getElementById('filter_table_list').innerHTML = tbody;
        }
      }
      xhr.send();
      return result;
    }

    function CompleteReservation() {
      var reserId = document.getElementById("search_Reser").value;
      let xhr = new XMLHttpRequest()
      xhr.open("PUT", `http://localhost:8080/reservation/complete/${reserId}`, true)
      xhr.setRequestHeader('Content-type', 'application/json; charset=UTF-8')
      xhr.onload = function () {
        var result = this.responseText;

        console.log(result);
      }
      xhr.send();
      location.reload();
    }
    function CancelReservation() {
      var reserId = document.getElementById("search_Reser").value;
      let xhr = new XMLHttpRequest()
      xhr.open("PUT", `http://localhost:8080/reservation/cancelreservation/${reserId}`, true)
      xhr.setRequestHeader('Content-type', 'application/json; charset=UTF-8')
      xhr.onload = function () {
        var result = this.responseText;

        console.log(result);
      }
      xhr.send();
      location.reload();
    }
    function UpdatePassword() {
      var password = document.getElementById("password").value;
      var confirm = document.getElementById("confirm-password").value;
      if (password == confirm) {
        document.getElementById("notice").innerHTML = "";
        document.getElementById("notice").innerHTML = "";
        let xhr = new XMLHttpRequest()
        xhr.open("PUT", `http://localhost:8080/account/changepassword/${password}`, true)
        xhr.setRequestHeader('Content-type', 'application/json; charset=UTF-8')
        xhr.onload = function () {
          var result = this.responseText;

          console.log(result);
        }
        xhr.send();
        location.reload();
      } else {
        document.getElementById("notice").innerHTML = "Confirm Password must same as Password !!!";
      }
    }
  </script>
</body>

</html>